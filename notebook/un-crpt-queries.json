{
  "cells": [
    {
      "id": "ad0b97af-4437-4d23-88e1-f385d69467ea",
      "inputs": [
      ],
      "name": "",
      "source": "/* \n * Establish relationships between stresses and specific indicators\n */\n\n// Relation to capture the connection added to stress_type_given.rel\n// def indicator_stress = \n//     indicator_prioritymatter . \n//     prioritymatter_stress_type\n\n// Example query:\n((transpose[indicator_code])[\"1.2.2.2\"]) . indicator_stress . (transpose[stress_type_from_name])\n",
      "type": "query"
    },
    {
      "id": "3b59e618-3c5f-4589-a18e-21199a691297",
      "inputs": [
      ],
      "source": "/*\n * Which Priority Matters should be prioritized for action? (the ones having the worst impacts or worst projections).\n */\n\n// Example query: get priority matters with at least one Red indicator\npm_n: indicator_prioritymatter(i, pm) and indicator_value(i, \"Red\") and priority_matter_name_prioritymatter(pm_n, pm) from pm, i\n\n",
      "type": "query"
    },
    {
      "id": "81c23bd6-b6d3-4a1d-bb70-1dd648d0774c",
      "inputs": [
      ],
      "name": "",
      "source": "/* \n * Which Shocks are causing more impact?\n */\n\n// Get count for shock in a priority matter\np_n, c : c = count[s: shock_subtype_prioritymatter(s, p)] and priority_matter_name_prioritymatter(p_n, p) from p",
      "type": "query"
    },
    {
      "id": "0220d989-4fb2-4e79-bc7d-cf766e73d0ff",
      "inputs": [
      ],
      "name": "",
      "source": "// Get count for priority matters that are impacted by shock\ns_n, c : c = count[p: shock_subtype_prioritymatter(s, p)] and from_shock_subtype_name(s_n, s) from s\n",
      "type": "query"
    },
    {
      "id": "d65d2072-3cd5-44e3-9cbb-6387698f3da0",
      "inputs": [
      ],
      "name": "",
      "source": "/*\n * Additional example (not from Miquel's email)\n */\n\n// Get the number of people diretly affected by shock type \"Viral Epidemic & Pandemic Disease\"\nst_n, nr_aff : st_n = \"Viral Epidemic & Pandemic Disease\" and st = from_shock_subtype_name[st_n] and shock_impact_subtype(s, st) and shock_impact_people_indirectly_affected(s, nr_aff) from st, s",
      "type": "query"
    },
    {
      "id": "9a6badaf-e97b-4262-9621-68469ccac7ce",
      "inputs": [
      ],
      "name": "",
      "source": "// From here basic queries on Teresina's CSV files\n\n// basic query on elements\ndef output = c0, c, n : urban_element_type_city(e,c0) and urban_element_type_code(e,c) and urban_element_type_name(e,n) from e",
      "type": "query"
    },
    {
      "id": "b0159d3d-9ba6-427a-801d-47cdcc4d0eb8",
      "inputs": [
      ],
      "name": "",
      "source": "// basic query on components\ndef output = c0, ec, c, n : component_type_city(e,c0) and component_type_element_code(e, ec) and component_type_code(e,c) and component_type_name(e,n) from e",
      "type": "query"
    },
    {
      "id": "dc0942a1-de14-43e9-bc2f-c3b6e6b27d59",
      "inputs": [
      ],
      "name": "",
      "source": "// basic query on shocks\n//def output = c0, g, t, s, pda, pia, tg, ue, c, i, d, lowd, loj: shock_impact_city(c0, e) and shock_impact_group(g,e) and shock_impact_type(t,e) and shock_impact_subtype(s,e) and shock_impact_people_directly_affected(pda,e) and shock_impact_people_indirectly_affected(pia,e) and shock_impact_caused_shock(ts, e) and shock_impact_affected_urban_elements(ue,e) and shock_impact_number_of_casualties(c,e) and shock_impact_number_of_injured(i, e) and shock_impact_number_of_displaced(d,e) and shock_impact_loss_of_working_days(lowd,e) and shock_impact_loss_of_jobs(loj,e) from e\n",
      "type": "query"
    },
    {
      "id": "2ad25c60-ce7c-415d-8b53-b64275597f8a",
      "inputs": [
      ],
      "name": "",
      "source": "// basic query on stresses\ndef output = c, n : stress_type_city(e,c) and stress_type_name(e,n) from e",
      "type": "query"
    },
    {
      "id": "6dca981f-2c4c-4a31-8299-eb6737ac6b82",
      "inputs": [
      ],
      "name": "",
      "source": "// basic query on stressors\nstressor_type_from_name . stressor_type_stress_type . (transpose[stress_type_from_name])\n",
      "type": "query"
    },
    {
      "id": "51c335cf-58b1-4660-8cf3-ebb3099c5099",
      "inputs": [
      ],
      "name": "",
      "source": "st_n, ss_n: stressor_type_from_name(st_n,st) and stressor_type_stress_type(st,ss) and (transpose[stress_type_from_name])(ss,ss_n) from ss,st\n",
      "type": "query"
    },
    {
      "id": "17214e9d-ae9a-47f5-b7ee-54a4937e86bb",
      "inputs": [
      ],
      "name": "",
      "source": "// basic query on ppi\ndef output = c, t, d, y, s, cat : ppi_city(ppi, c) and ppi_type(ppi, t) and ppi_description(ppi, d) and ppi_year(ppi, y) and ppi_status(ppi, s) and ppi_category(ppi, cat) from ppi \n",
      "type": "query"
    },
    {
      "id": "d507a8ee-ed96-48fc-b4bc-dce545150812",
      "inputs": [
      ],
      "name": "",
      "source": "// basic query on priority mattters\ndef output = c, p : prioritymatter_city(pm, c) and prioritymatter_name(pm, p) from pm\n",
      "type": "query"
    },
    {
      "id": "1509e6a1-597a-49fb-a161-3d0232a0adea",
      "inputs": [
      ],
      "name": "",
      "source": "// basic query on stakeholders\ndef output = c, n, d : organization_city(s, c) and organization_name(s, n) and organization_description(s, d) from s\n",
      "type": "query"
    },
    {
      "id": "f0ab8734-e2c5-45e4-bccc-6ece39e5be2a",
      "inputs": [
      ],
      "name": "",
      "source": "// 1.a\n\ndef floods = stn, dt: from_shock_type_name(stn, st) and \n(((transpose[shock_subtype_belongs_to_shock_type]) . \n  (transpose[shock_impact_subtype]) . \n  shock_impact_date)(st, dt)) \nand stn = \"FLOOD\"\nfrom st\n\ndef output = count[floods[_]]\n",
      "type": "query"
    },
    {
      "id": "16b22305-7ca3-49b1-bd07-9fa46020660f",
      "inputs": [
      ],
      "name": "",
      "source": "// 1.b\n\n// Get the number of people directly affected by shock type \"Viral Epidemic & Pandemic Disease\"\ndef loss_of_working_days = s, lowd : st_n = \"FLOOD\" and \n  st = from_shock_type_name[st_n] and \n  shock_subtype_belongs_to_shock_type(sst, st) and \n  shock_impact_subtype(s, sst) and \n  shock_impact_loss_of_working_days(s, lowd) \n  from sst, st, st_n\n\ndef output = sum[loss_of_working_days]\n\n",
      "type": "query"
    },
    {
      "id": "cdf89392-65f3-46c8-9647-8d5644a0e949",
      "inputs": [
      ],
      "name": "",
      "source": "// 1.c\n\n// Get the number of people directly affected by shock type \"FLOOD\"\ndef nr_of_people_driectly_affected = st_n, nr_aff : st_n = \"FLOOD\" and \n  st = from_shock_type_name[st_n] and \n  shock_subtype_belongs_to_shock_type(sst, st) and \n  shock_impact_subtype(s, sst) and \n  shock_impact_people_directly_affected(s, nr_aff) \n  from sst, st, s\n\ndef output = sum[nr_of_people_driectly_affected[_]]",
      "type": "query"
    },
    {
      "id": "64325fdc-17ab-4dfe-ba99-e5292949803b",
      "inputs": [
      ],
      "name": "",
      "source": "// 1.d \n\nst_n, tr_sst_n:\n  shock_impact_caused_shock(s, tr_sst_n) and\n  st_n = \"FLOOD\" and \n  st = from_shock_type_name[st_n] and \n  shock_subtype_belongs_to_shock_type(sst, st) and \n  shock_impact_subtype(s, sst)\n  from s, st, sst, tr_sst",
      "type": "query"
    },
    {
      "id": "914d3910-2b2d-46bb-84d3-20ea34f66901",
      "inputs": [
      ],
      "name": "",
      "source": "// 1.e\n\nst_n, ue:\n  st_n = \"FLOOD\" and \n  st = from_shock_type_name[st_n] and \n  shock_subtype_belongs_to_shock_type(sst, st) and \n  shock_impact_subtype(s, sst) and\n  shock_impact_affected_urban_elements(s, ue)\n  from s, st, sst",
      "type": "query"
    },
    {
      "id": "3626db64-ec9e-4118-a1e4-6e8ffad03e06",
      "inputs": [
      ],
      "name": "",
      "source": "// 2.\n\ni_c, i_v:\n  indicator_code(i, i_c) and\n  indicator_value(i, i_v) and\n  indicator_prioritymatter(i, pm) and \n  prioritymatter:priority_matter(pm, \"Economic Underperformance\") from pm, i\n",
      "type": "query"
    },
    {
      "id": "8cb5b9f2-e250-4f2c-9940-bcf5ccb78c59",
      "inputs": [
      ],
      "name": "",
      "source": "// 3.\n// List the indicators with Red value for triggered shocks by flooding\n\n// Query from 1.d\ndef shocks_triggered_by_shock_type = st_n, tr_sst_n:\n  shock_impact_caused_shock(s, tr_sst_n) and\n  st = from_shock_type_name[st_n] and \n  shock_subtype_belongs_to_shock_type(sst, st) and \n  shock_impact_subtype(s, sst)\n  from s, st, sst, tr_sst\n\ndef output = i_c, i_d, i_v, sst_n:\n  indicator_code(i, i_c) and\n  indicator_value(i, i_v) and\n  i_v = \"Red\" and\n  indicator_description(i, i_d) and\n  indicator_shock_subtype(i, sst) and \n  from_shock_subtype_name(sst_n, sst) and\n  sst_n = shocks_triggered_by_shock_type[\"FLOOD\"]\n  from i, sst",
      "type": "query"
    },
    {
      "id": "cbb182ad-5981-4b55-9ee5-23de27da563a",
      "inputs": [
      ],
      "name": "",
      "source": "// 4.\n// Same as above, but with elements\n\n// Query from 1.d\ndef shocks_triggered_by_shock_type = st_n, tr_sst_n:\n  shock_impact_caused_shock(s, tr_sst_n) and\n  st = from_shock_type_name[st_n] and \n  shock_subtype_belongs_to_shock_type(sst, st) and \n  shock_impact_subtype(s, sst)\n  from s, st, sst, tr_sst\n\ndef output = e, sst_n:\n  from_shock_subtype_name(sst_n, sst) and\n  sst_n = shocks_triggered_by_shock_type[\"FLOOD\"] and\n  shock_impact_subtype(s, sst) and\n  shock_impact_affected_urban_elements(s, e)\n  from sst, s",
      "type": "query"
    },
    {
      "id": "14f52635-c854-43ed-afe2-5bec15fd6716",
      "inputs": [
      ],
      "name": "",
      "source": "// 5.a and b\n// Get the stresses that impact the same urban elements that are impacted by the shock\n// And do the same thing with the stresses triggered by the shock (FLOOD)\n",
      "type": "query"
    }
  ],
  "metadata": {
    "notebookFormatVersion": "0.0.1"
  }
}
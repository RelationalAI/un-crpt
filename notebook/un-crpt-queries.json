{
  "cells": [
    {
      "id": "608af0e6-3cf7-4d46-bf48-d3dff393ddda",
      "inputs": [
      ],
      "isCodeFolded": true,
      "name": "",
      "source": "# City Resilience Profiling Tool\n\n## Types of Questions\n_... that our tool should be able to answer_\n\n* What are the highest risks (i.e. that cause most impact)?\n* Which elements and components of the city are affected by floods?\n* What are the indicators (i.e. data) relate to the elements affected by floods?\n* What are alternatives that would change the risks (i.e. counterfactuals)?\n* What is the relationship between shocks (chain of events)\n* What are the 2nd or 3rd level effects of a flood?\n\n## Ontology\n\n![https://drive.google.com/uc?export=download&id=1CSUIXswH4le2zXR8OjhAMw1iUd-Nann9](https://drive.google.com/uc?export=download&id=1CSUIXswH4le2zXR8OjhAMw1iUd-Nann9)\n\n## Use Case from a real city\n\n* Flooding is a well known problem in the city.\n* Around 50% of indicators collected.\n* Some data on historical significant shock impacts.\n* Interest of the city is economy.\n* Following the interest of the city, first assessment would focus on 18 economy indicators and 8 mobility indicators as the base for providing recommendations for action.\n\nAdditional analysis using the knowledge graph:\n\n* Impact of flooding showing relevance over the economy of the city\n* Impact of shocks triggered by flood \n* Impact of all these shocks over all the urban elements\n",
      "type": "markdown"
    },
    {
      "id": "077ad541-0caf-48d5-b66c-f43eb2864b8f",
      "inputs": [
      ],
      "isCodeFolded": false,
      "name": "un-crpt-queries-shock_type_name_to_shock_impact_name_and_date",
      "source": "// 1.a\n\ndef shock_type_name_to_shock_impact_name_and_date = stn, sstn, dt: \n  shock_type_name_to_shock_subtype_name(stn, sstn) and \n  shock_subtype_name_to_shock_impact(sstn, s) and\n  shock_impact_date(s, dt)\n  from s\n",
      "type": "install"
    },
    {
      "id": "52bed5ee-971f-41ff-97f8-0d3e0bfa148c",
      "inputs": [
      ],
      "isCodeFolded": false,
      "name": "",
      "source": "shock_type_name_to_shock_impact_name_and_date[\"FLOOD\"]",
      "type": "query"
    },
    {
      "id": "f0ab8734-e2c5-45e4-bccc-6ece39e5be2a",
      "inputs": [
      ],
      "name": "",
      "source": "def output = count[shock_type_name_to_shock_impact_name_and_date[\"FLOOD\"]]\n",
      "type": "query"
    },
    {
      "id": "6035e297-bb97-4aff-b41d-40b74f76453b",
      "inputs": [
      ],
      "name": "",
      "source": "Impact of flooding showing relevance over the economy of the city\n\n* Occurrences of flooding over total number of shock impacts\n* Impact on people → Directly affected people\n* Direct impact on economy → Loss of working days\n* Direct impact on economy → Loss of jobs\n",
      "type": "markdown"
    },
    {
      "id": "c9db22ee-6b22-4884-9d98-8a77d6ee18a6",
      "inputs": [
      ],
      "name": "un-crpt-queries-model-3",
      "source": "def shock_type_name_to_shock_and_loss_of_working_days = stn, s, lowd : \n  shock_type_name_to_shock_impact(stn, s) and\n  shock_impact_loss_of_working_days(s, lowd) ",
      "type": "install"
    },
    {
      "id": "16b22305-7ca3-49b1-bd07-9fa46020660f",
      "inputs": [
      ],
      "name": "",
      "source": "def output = sum[shock_type_name_to_shock_and_loss_of_working_days[\"FLOOD\"]]\n",
      "type": "query"
    },
    {
      "id": "cdf89392-65f3-46c8-9647-8d5644a0e949",
      "inputs": [
      ],
      "name": "un-crpt-queries-model-4",
      "source": "// 1.c\n\ndef shock_type_name_to_shock_and_nr_of_people_driectly_affected = stn, s, nr_aff :\n  shock_type_name_to_shock_impact(stn, s) and\n  shock_impact_people_directly_affected(s, nr_aff) \n",
      "type": "install"
    },
    {
      "id": "1eaea50e-48fd-4fb5-8141-ae7e785be036",
      "inputs": [
      ],
      "name": "",
      "source": "def output = sum[shock_type_name_to_shock_and_nr_of_people_driectly_affected[\"FLOOD\"]]\n",
      "type": "query"
    },
    {
      "id": "0c6d3fc4-88b3-42ca-af7a-fe07d761f286",
      "inputs": [
      ],
      "name": "",
      "source": "Impact of shocks triggered by flood \n\n* Shocks triggered by flood: Bacterial Epidemic & Pandemic disease, Built Infrastructure Breakdown, Political Crisis, Sudden Inland Erosion \n* Which are the red indicators related to the shocks triggered by flood \n",
      "type": "markdown"
    },
    {
      "id": "64325fdc-17ab-4dfe-ba99-e5292949803b",
      "inputs": [
      ],
      "name": "un-crpt-queries-model-5",
      "source": "// 1.d \n\ndef shock_type_name_to_triggered_shock_subtype_name(stn, tr_sst_n) = \n  shock_type_name_to_shock_impact(stn, s) and\n  shock_impact_caused_shock(s, tr_sst_n)\n  from s",
      "type": "install"
    },
    {
      "id": "5af3f18c-075b-4904-ae25-4ed21c56ee70",
      "inputs": [
      ],
      "name": "",
      "source": "def output = shock_type_name_to_triggered_shock_subtype_name[\"FLOOD\"]\n",
      "type": "query"
    },
    {
      "id": "ac777e5f-c8e0-4c64-84a6-7fb66f6e66bb",
      "inputs": [
      ],
      "name": "un-crpt-queries-model-6",
      "source": "def shock_type_name_to_affected_urban_element(stn, ue) =\n  shock_type_name_to_shock_impact(stn, s) and\n  shock_impact_affected_urban_elements(s, ue)\n  from s",
      "type": "install"
    },
    {
      "id": "4aa79b48-bfd4-41ab-bd36-e08c88447b08",
      "inputs": [
      ],
      "name": "",
      "source": "def output = shock_type_name_to_affected_urban_element[\"FLOOD\"]\n",
      "type": "query"
    },
    {
      "id": "3626db64-ec9e-4118-a1e4-6e8ffad03e06",
      "inputs": [
      ],
      "name": "un-crpt-queries-model-7",
      "source": "def priority_matter_to_indicator_code_and_value(pm, i_c, i_d, i_v) = \n  indicator_code(i, i_c) and\n  indicator_description(i, i_d) and\n  indicator_value(i, i_v) and\n  indicator_to_prioritymatter_name(i, pm)\n  from i\n",
      "type": "install"
    },
    {
      "id": "886a6453-9214-4552-ab3b-8c340666f174",
      "inputs": [
      ],
      "name": "",
      "source": "priority_matter_to_indicator_code_and_value[\"Economic Underperformance\"]\n",
      "type": "query"
    },
    {
      "id": "8cb5b9f2-e250-4f2c-9940-bcf5ccb78c59",
      "inputs": [
      ],
      "name": "un-crpt-queries-model-8",
      "source": "// List the indicators with Red value for triggered shocks by flooding\n\ndef triggered_red_indicator_and_shock_subtype(cause, i_c, i_d, i_v, sstn) = \n  indicator_code(i, i_c) and\n  indicator_value(i, i_v) and\n  i_v = \"Red\" and\n  indicator_description(i, i_d) and\n  indicator_to_shock_subtype_name(i, sstn) and\n  sstn = shock_type_name_to_triggered_shock_subtype_name[cause]\n  from i",
      "type": "install"
    },
    {
      "id": "fe46b9f7-3c8c-4ade-bc09-c4bec18c4399",
      "inputs": [
      ],
      "name": "",
      "source": "def output = triggered_red_indicator_and_shock_subtype[\"FLOOD\"]",
      "type": "query"
    },
    {
      "id": "0d2bdd1b-13d8-4c38-ba1b-da3c99203b3e",
      "inputs": [
      ],
      "isCodeFolded": true,
      "name": "",
      "source": "Impact of shocks triggered by flood \n\n * Which are the urban elements affected by flood\n \n * Which are the red indicators related to the urban elements impacted by flood and triggered shocks\n",
      "type": "markdown"
    },
    {
      "id": "aa2ef554-8424-418c-affd-bf265e715ab4",
      "inputs": [
      ],
      "name": "un-crpt-queries-model-9",
      "source": "def triggered_shock_subtype_affecting_urban_elements(cause, sstn, e) =\n  sstn = shock_type_name_to_triggered_shock_subtype_name[cause] and\n  shock_subtype_name_to_affected_urban_element(sstn, e)\n",
      "type": "install"
    },
    {
      "id": "d344fdf6-eb86-4825-a679-fbf1eec83f01",
      "inputs": [
      ],
      "name": "",
      "source": "def output = triggered_shock_subtype_affecting_urban_elements[\"FLOOD\"]\n\n// only affected urban elements\n//def output = triggered_shock_subtype_affecting_urban_elements[\"FLOOD\"][_]\n",
      "type": "query"
    },
    {
      "id": "51b8e550-d83c-486d-bb7e-397fafe0bdf6",
      "inputs": [
      ],
      "isCodeFolded": true,
      "name": "",
      "source": "Long-term impacts\n\n* Stresses impacting the same elements or indicators as Flood",
      "type": "markdown"
    },
    {
      "id": "14f52635-c854-43ed-afe2-5bec15fd6716",
      "inputs": [
      ],
      "name": "un-crpt-queries-model-10",
      "source": "// 5.a\n\n// Get the stresses that impact the same urban elements that are impacted by the shock\ndef shock_type_to_urban_element_with_stress(stn, uen, strn) = \n  stress_type_name_to_urban_element_name(strn, uen) and\n  uen = shock_type_name_to_affected_urban_element[stn]",
      "type": "install"
    },
    {
      "id": "509bd7fa-c51b-481a-bc82-b0ad544f676d",
      "inputs": [
      ],
      "name": "",
      "source": "shock_type_to_urban_element_with_stress[\"FLOOD\"]",
      "type": "query"
    },
    {
      "id": "825113ca-5512-4e85-a0f2-03050f6ef20b",
      "inputs": [
      ],
      "name": "un-crpt-queries-model-11",
      "source": "// 5.b\n\n// Get the shocks that impact the same urban elements that are impacted by the shock\ndef shock_type_name_to_triggered_shock_subtypes_and_affected_ue(stn, uen, trsn) = \n  uen = shock_type_name_to_affected_urban_element[stn] and\n  trsn = shock_type_name_to_triggered_shock_subtype_name[stn] and\n  uen = shock_subtype_name_to_affected_urban_element[trsn]",
      "type": "install"
    },
    {
      "id": "e17958c9-446c-4c5a-b3b1-8ed3980bab14",
      "inputs": [
      ],
      "name": "",
      "source": "shock_type_name_to_triggered_shock_subtypes_and_affected_ue[\"FLOOD\"]",
      "type": "query"
    },
    {
      "id": "4d9fd937-0d94-4216-b7d5-2554f54bb070",
      "inputs": [
      ],
      "isCodeFolded": true,
      "name": "un-crpt-queries-helpers",
      "source": "// Helper relations - not part of the discussions during the main demo\n\ndef shock_type_name_to_shock_subtype_name(stn, sstn) = \n  from_shock_type_name(stn, st) and\n  from_shock_subtype_name(sstn, sst) and\n  shock_subtype_belongs_to_shock_type(sst, st)\n  from sst, st\n\ndef shock_subtype_name_to_shock_impact(sstn, s) = \n  shock_subtype_to_impact(sst, s) and\n  from_shock_subtype_name(sstn, sst)\n  from sst\n\ndef shock_subtype_name_to_affected_urban_element(sstn, e) = \n  from_shock_subtype_name(sstn, sst) and\n  shock_impact_subtype(s, sst) and\n  shock_impact_affected_urban_elements(s, e)\n  from sst, s\n\ndef shock_type_name_to_affected_urban_element(stn, e) = \n  from_shock_type_name(stn, st) and\n  shock_type_contains_shock_subtype(st, sst) and\n  shock_impact_subtype(s, sst) and\n  shock_impact_affected_urban_elements(s, e)\n  from sst, st, s\n\ndef shock_type_name_to_shock_impact = \n  shock_type_name_to_shock_subtype_name . shock_subtype_name_to_shock_impact\n\ndef indicator_to_prioritymatter_name(i, pmn) = \n  indicator_prioritymatter(i, pm) and \n  prioritymatter:priority_matter(pm, pmn) \n  from pm\n\ndef indicator_to_shock_subtype_name(i, sstn) = \n  indicator_shock_subtype(i, sst) and\n  from_shock_subtype_name(sstn, sst)\n  from sst\n\ndef stress_type_name_to_urban_element_name(strn, uen) = \n  (stress_type_from_name . stress_type_urban_element_code)(strn, uec) and\n  urban_element_type_code(ue, uec) and\n  urban_element_type_name(ue, uen)\n  from ue, uec\n",
      "type": "install"
    }
  ],
  "metadata": {
    "notebookFormatVersion": "0.0.1"
  }
}